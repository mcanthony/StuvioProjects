(function(){var b=bongiovi.GL;SuApp=function(c){this._canvas=c;b.init(this._canvas,null,null,{preserveDrawingBuffer:!0});this._init()};var a=SuApp.prototype;a._init=function(){bongiovi.SimpleImageLoader.load(["assets/images/bg.jpg","assets/images/ConstellationCircle.png","assets/images/milkyWayCopy.png","assets/images/starLine.png"],this,this._init3D)};a._init3D=function(c){SuModel.images=c;this._scene=new SceneSu;b.setSize(this._canvas.width,this._canvas.height);bongiovi.Scheduler.addEF(this,this._loop)};
a.refresh=function(b){this._scene&&this._scene.refresh(b)};a._loop=function(){this._scene.loop()};a.resize=function(){b.setSize(this._canvas.width,this._canvas.height)}})();(function(){var b=bongiovi.GL,a=b.gl,c=bongiovi.GLTexture,g=bongiovi.ViewCopy;SceneSu=function(){bongiovi.Scene.call(this);window.params={constellationIndex:-1,cameraRadius:500};this.sceneRotation.rotateMargin=200;this.sceneRotation.inverseControl(!0);this._invert=!1;this.cameraPositions=SuModel.cameraPositions;window.addEventListener("keydown",this._onSave.bind(this));params.constellationIndex=0;this._onConstellationChange();for(var b=SuModel.stars,c=[],a=["constellation","constellationIndex","distance"],
g=0;g<b.length;g++){var d=b[g],n={},p;for(p in d)-1==a.indexOf(p)&&(n[p]=d[p]);n.ra=f(d.ra);n.de=f(d.de);c.push(n)}};var d=SceneSu.prototype=new bongiovi.Scene;d._initGUI=function(){this._gui=new dat.GUI({width:300});var b=this;this._gui.add(params,"constellationIndex",0,88).listen().onChange(function(){b._onConstellationChange()})};d.refresh=function(e){params.constellationIndex!=e.constellationIndex.value-1&&(params.constellationIndex=e.constellationIndex.value-1,this._onConstellationChange());
this._invert=e.invertColor.value;!this._fbo||b.width==this._fbo.width&&b.height==this._fbo.height||(this._fbo=new bongiovi.FrameBuffer(b.width,b.height),this._passInvert=new bongiovi.Pass("assets/shaders/invert.frag",b.width,b.height))};d._onConstellationChange=function(){var b=Sutils.getDrawingPath(params.constellationIndex),c=this.cameraPositions[params.constellationIndex];c&&(this.sceneRotation.setCameraPos(c.quat),this.camera.radius.value=c.z);""!=b?(console.log("Path : ",b,params.constellationIndex),
c=new Image,c.addEventListener("load",this._onImageLoaded.bind(this)),c.src="assets/images/hevelius/"+b,this._vCircleBg.targetAlpha=1,this._vDrawings.tweenAlpha(0,0)):(console.log("Image doesn't exist : ",Sutils.getConstellatinDetail(params.constellationIndex)),this._vDrawings.targetAlpha=0,this._vCircleBg.targetAlpha=0);if(b=Sutils.getConstellatinDetail(params.constellationIndex))c=new Image,c.addEventListener("load",this._onDescImageLoaded.bind(this)),c.src="assets/images/copy/"+b.abb+".png",this._vDesc.tweenAlpha(0,
0),this._vCopyMilkyway.targetAlpha=0,this._vCopyEliptic.targetAlpha=0};d._onImageLoaded=function(b){void 0==this._textDrawing?this._textDrawing=new c(b.target):this._textDrawing.updateTexture(b.target);this._vDrawings.tweenAlpha(0,1)};d._onDescImageLoaded=function(b){void 0==this._textDesc?this._textDesc=new c(b.target):this._textDesc.updateTexture(b.target);this._vDesc.tweenAlpha(0,1)};d._initTextures=function(){a=b.gl;this._textBG=new c(SuModel.images.bg);this._textStar=new c(SuModel.images.starLine);
this._textCircleBg=new c(SuModel.images.ConstellationCircle);this._textMilkyCopy=new c(SuModel.images.milkyWayCopy);this._fbo=new bongiovi.FrameBuffer(b.width,b.height)};d._initViews=function(){this._vCopy=new g;this._vStars=new ViewStars;this._vLines=new ViewLines;this._vStarmap=new ViewStarmap;this._vMilkyway=new ViewMilkyWays;this._vEcliptic=new ViewMilkyWays(!0);this._vCircleBg=new ViewDrawings([0,0,0],1.03);this._vDrawings=new ViewDrawings([0,0,0],1.25);this._vDesc=new ViewDrawings([0,-0.68,
0],1,0.25);this._vGlobeLines=new ViewGlobeLines;this._vBlack=new g(null,"assets/shaders/black.frag");this._vCopyMilkyway=new ViewMilkyWayCopy;this._vCopyEliptic=new ViewMilkyWayCopy(!0);this._effectComposer=new bongiovi.EffectComposer;this._passInvert=new bongiovi.Pass("assets/shaders/invert.frag",b.width,b.height);this._effectComposer.addPass(this._passInvert)};d.render=function(){params.cameraRadius=this.camera.radius.value;this._invert?this.renderInvert():(a.lineWidth(1.5),a.disable(a.DEPTH_TEST),
b.setMatrices(this.cameraOtho),b.rotate(this.rotationFront),this._vCopy.render(this._textBG),b.setMatrices(this.camera),b.rotate(this.sceneRotation.matrix),this._vGlobeLines.render(),this._vMilkyway.render(),this._vEcliptic.render(),this._vCopyMilkyway.render(this._textMilkyCopy),this._vCopyEliptic.render(this._textMilkyCopy),this._vStars.render(this._textStar),this._vLines.render(),b.setMatrices(this.cameraOtho),b.rotate(this.rotationFront),this._textDrawing&&(this._vCircleBg.render(this._textCircleBg),
b.enableAdditiveBlending(),this._vBlack.render(this._textCircleBg),b.enableAlphaBlending(),this._vDrawings.render(this._textDrawing)),this._textDesc&&this._vDesc.render(this._textDesc))};d.renderInvert=function(){a.lineWidth(1.5);this._fbo.bind();b.clear(0,0,0,0);a.disable(a.DEPTH_TEST);b.setMatrices(this.cameraOtho);b.rotate(this.rotationFront);this._vCopy.render(this._textBG);b.setMatrices(this.camera);b.rotate(this.sceneRotation.matrix);this._vGlobeLines.render();this._vMilkyway.render();this._vEcliptic.render();
this._vCopyMilkyway.render(this._textMilkyCopy);this._vCopyEliptic.render(this._textMilkyCopy);this._vStars.render(this._textStar);this._vLines.render();a.disable(a.DEPTH_TEST);b.setMatrices(this.cameraOtho);b.rotate(this.rotationFront);this._textDrawing&&(b.enableAdditiveBlending(),this._vDrawings.render(this._textDrawing),b.enableAlphaBlending());this._textDesc&&this._vDesc.render(this._textDesc);this._fbo.unbind();b.setMatrices(this.cameraOtho);b.rotate(this.rotationFront);this._effectComposer.render(this._fbo.getTexture());
this._vCopy.render(this._effectComposer.getTexture())};d._onMouseDown=function(b){params.constellationIndex=-1;this._vDrawings&&(this._vDrawings.targetAlpha=0);this._vDesc&&(this._vDesc.targetAlpha=0);this._vCircleBg&&(this._vCircleBg.targetAlpha=0);this._vCopyMilkyway.targetAlpha=1;this._vCopyEliptic.targetAlpha=1};d._onSave=function(c){if(83==c.keyCode){c=b.canvas.toDataURL("image/jpeg");var a=new Image;a.src=c;document.body.appendChild(a);a.style.position="absolute"}else if(84==c.keyCode)c=Sutils.getQuatRotation(SuModel.cameraPositions[75].quaternion),
this.sceneRotation.setCameraPos(c);else if(39==c.keyCode)params.constellationIndex++,this._onConstellationChange();else if(37==c.keyCode)params.constellationIndex--,0>params.constellationIndex&&(params.constellationIndex=0),this._onConstellationChange();else if(80==c.keyCode)this.cameraPositions[params.constellationIndex]={z:this.camera.position[2],quat:[f(this.sceneRotation.tempRotation[0]),f(this.sceneRotation.tempRotation[1]),f(this.sceneRotation.tempRotation[2]),f(this.sceneRotation.tempRotation[3])]},
console.log("Saving : ",this.cameraPositions[params.constellationIndex]);else if(87==c.keyCode){c=JSON.stringify(this.cameraPositions);for(var a=[],g=0;g<c.length;g++)a[g]=c.charCodeAt(g);c=new Uint8Array(a);c=new Blob([c],{type:"application/octet-stream"});url=URL.createObjectURL(c);c=document.createElement("a");c.setAttribute("href",url);c.setAttribute("download","cameraPosition.json");a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null);c.dispatchEvent(a)}};
var f=function(c,b){var a=Math.pow(10,b||4);return Math.floor(c*a)/a}})();var Sutils={getStarPosition:function(b,a,c){var g=z=0,d=Math.PI/180,f=c*Math.sin(a*d);a=c*Math.cos(a*d);g=-a*Math.cos(b*d);z=a*Math.sin(b*d);return[g,f,z]},getStarById:function(b){for(var a=0;a<SuModel.stars.length;a++)if(SuModel.stars[a].id==b)return SuModel.stars[a]},getQuatRotation:function(b){b=b.split(",");return quat.fromValues(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]))},getDrawingPath:function(b){for(var a in SuModel.drawings)if(parseInt(SuModel.drawings[a].split("imgConstellation")[1])==
b)return a.replace(".jpg",".png");return""},getConstellatinDetail:function(b){if(!SuModel.constellations[b])return null;b=SuModel.constellations[b].id;for(var a=0;a<SuModel.constellationDesc.length;a++)if(SuModel.constellationDesc[a].abb==b)return SuModel.constellationDesc[a];return null}};(function(){var b=bongiovi.GL;ViewDrawings=function(c,b,a){this.targetAlpha=this._alpha=1;this.easing=0.1;this._position=c||[];this._scale=void 0==b?1:b;this._ratio=void 0==a?1:a;bongiovi.View.call(this,bongiovi.ShaderLibs.getShader("generalVert"),bongiovi.ShaderLibs.getShader("alphaFrag"))};var a=ViewDrawings.prototype;a._init=function(){this.mesh=bongiovi.MeshUtils.createPlane(2,2,1)};a.tweenAlpha=function(c,b){this._alpha=c;this.targetAlpha=b};a.render=function(c){this.mesh&&(this._alpha+=(this.targetAlpha-
this._alpha)*this.easing,this.shader.bind(),this.shader.uniform("texture","uniform1i",0),this.shader.uniform("opacity","uniform1f",this._alpha),this.shader.uniform("position","uniform3fv",this._position),this.shader.uniform("scale","uniform3fv",[this._scale,b.aspectRatio*this._scale*this._ratio,this._scale]),c.bind(0),b.draw(this.mesh))}})();(function(){var b=bongiovi.GL;ViewGlobeLines=function(){bongiovi.View.call(this,"assets/shaders/globeLine.vert","assets/shaders/globeLine.frag")};var a=ViewGlobeLines.prototype=new bongiovi.View;a._init=function(){var c=[],a=[],d=[],f=0,e,h,k=function(b,c){var a=b/64*Math.PI-0.5*Math.PI,g=c/64*Math.PI*2,d=[];d[1]=510*Math.sin(a);a=510*Math.cos(a);d[0]=Math.cos(g)*a;d[2]=Math.sin(g)*a;return d};for(h=0;64>h;h+=4)for(e=0;64>e;e++){var l=k(e,h),m=k(e+1,h);c.push(l);c.push(m);a.push(l);a.push(m);d.push(f);
d.push(f+1);f+=2}for(h=0;64>h;h++)for(e=0;64>e;e+=4)l=k(e,h),m=k(e,h+1),c.push(l),c.push(m),a.push(l),a.push(m),d.push(f),d.push(f+1),f+=2;this.mesh=new bongiovi.Mesh(c.length,d.length,b.gl.LINES);this.mesh.bufferVertex(c);this.mesh.bufferTexCoords(a);this.mesh.bufferIndices(d)};a.render=function(){this.mesh&&(this.shader.bind(),this.shader.uniform("color","uniform3fv",[1,1,1]),this.shader.uniform("opacity","uniform1f",0.05),this.shader.uniform("cameraRadius","uniform1f",params.cameraRadius),b.draw(this.mesh))}})();(function(){var b=bongiovi.GL;ViewLines=function(){bongiovi.View.call(this,"assets/shaders/lines.vert","assets/shaders/lines.frag")};var a=ViewLines.prototype=new bongiovi.View;a._init=function(){for(var c=[],a=[],d=[],f=0,e=0;e<SuModel.constellations.length;e++)for(var h=SuModel.constellations[e].lines,k=0;k<h.length;k++){var l=h[k],m=Sutils.getStarById(l[0]),l=Sutils.getStarById(l[1]),m=Sutils.getStarPosition(m.ra,m.de,500),l=Sutils.getStarPosition(l.ra,l.de,500);c.push(m);c.push(l);a.push([e,0]);
a.push([e,0]);d.push(f);d.push(f+1);f+=2}this.mesh=new bongiovi.Mesh(c.length,d.length,b.gl.LINES);this.mesh.bufferVertex(c);this.mesh.bufferTexCoords(a);this.mesh.bufferIndices(d)};a.render=function(){this.shader.isReady()&&(this.shader.bind(),this.shader.uniform("currentIndex","uniform1f",params.constellationIndex),this.shader.uniform("cameraRadius","uniform1f",params.cameraRadius),b.draw(this.mesh))}})();(function(){var b=bongiovi.GL;ViewMilkyWayCopy=function(b){this._isEcliptic=b||!1;this.targetAlpha=this._alpha=1;this.easing=0.1;b=b?[-0.015888573601841927,0.2025793343782425,0.9791369438171387,0]:[-0.4161895215511322,0.3992542028427124,0.7155793905258179,0.3941173553466797];this._rotation=new bongiovi.SceneRotation;this._rotation.tempRotation.set(b);this._rotation._rotation.set(b);this._rotation.update();this._rotation.lock();this.matrix=mat4.create();bongiovi.View.call(this,"assets/shaders/milkyway.vert",
bongiovi.ShaderLibs.getShader("alphaFrag"))};var a=ViewMilkyWayCopy.prototype=new bongiovi.View;a._init=function(){var c=[],a=[],d=[0,1,2,0,2,3,4,5,6,4,6,7];c.push([-70,-14,-480]);c.push([70,-14,-480]);c.push([70,56,-480]);c.push([-70,56,-480]);c.push([70,-14,480]);c.push([-70,-14,480]);c.push([-70,56,480]);c.push([70,56,480]);this._isEcliptic?(a.push([0,0]),a.push([1,0]),a.push([1,0.5]),a.push([0,0.5]),a.push([0,0]),a.push([1,0]),a.push([1,0.5]),a.push([0,0.5])):(a.push([0,0.5]),a.push([1,0.5]),
a.push([1,1]),a.push([0,1]),a.push([0,0.5]),a.push([1,0.5]),a.push([1,1]),a.push([0,1]));this.mesh=new bongiovi.Mesh(c.length,d.length,b.gl.TRIANGLES);this.mesh.bufferVertex(c);this.mesh.bufferTexCoords(a);this.mesh.bufferIndices(d)};a.render=function(a){this._alpha+=(this.targetAlpha-this._alpha)*this.easing;this.shader.bind();this.shader.uniform("texture","uniform1i",0);this.shader.uniform("opacity","uniform1f",this._alpha);this.shader.uniform("rotation","uniformMatrix4fv",this._rotation.matrix);
a.bind(0);b.draw(this.mesh)}})();(function(){var b=bongiovi.GL;ViewMilkyWays=function(b){this._isEcliptic=b||!1;var a=b?[-0.015888573601841927,0.2025793343782425,0.9791369438171387,0]:[-0.4161895215511322,0.3992542028427124,0.7155793905258179,0.3941173553466797];this._lineColor=b?[0.1176,0.4745,0.8902,1]:[1,0.8745,0.6039,0.15];this._rotation=new bongiovi.SceneRotation;this._rotation.tempRotation.set(a);this._rotation._rotation.set(a);this._rotation.update();this._rotation.lock();bongiovi.View.call(this,"assets/shaders/milkyway.vert",
"assets/shaders/milkyway.frag")};var a=ViewMilkyWays.prototype=new bongiovi.View;a._init=function(){function a(b,c,d,e,f,g){b=b/c*Math.PI*2;e=vec3.clone([d*Math.cos(b),Math.sin(b*e+g)*f,d*Math.sin(b)]);vec3.normalize(e,e);vec3.scale(e,e,d);return e}gl=b.gl;var g=this._isEcliptic?1500:100,d=[],f=[],e=[],h=0;if(this._isEcliptic)for(var k=0;k<g;k++)d.push(a(k,g,500,1,0,0)),d.push(a(k+1,g,500,1,0,0)),f.push([0,k%5]),f.push([0,k%5]),e.push(h),e.push(h+1),h+=2;else for(var l=0,m=60,n=0;10>n;n++)for(var m=
m-5,p=l,l=l+0.05*n,k=0;k<g;k++)d.push(a(k,g,500,2,m,p)),d.push(a(k+1,g,500,2,m,p)),f.push([k/g,0]),f.push([(k+1)/g,0]),e.push(h),e.push(h+1),h+=2;this.mesh=new bongiovi.Mesh(d.length,e.length,b.gl.LINES);this.mesh.bufferVertex(d);this.mesh.bufferTexCoords(f);this.mesh.bufferIndices(e)};a.render=function(){this.shader.bind();this.shader.uniform("rotation","uniformMatrix4fv",this._rotation.matrix);this.shader.uniform("cameraRadius","uniform1f",params.cameraRadius);this.shader.uniform("lineColor","uniform4fv",
this._lineColor);b.draw(this.mesh)}})();(function(){var b=bongiovi.GL;ViewStarmap=function(){bongiovi.View.call(this,null,"assets/shaders/starmap.frag")};var a=ViewStarmap.prototype=new bongiovi.View;a._init=function(){this.mesh=bongiovi.MeshUtils.createSphere(510,24)};a.render=function(a){this.shader.bind();this.shader.uniform("texture","uniform1i",0);a.bind(0);b.draw(this.mesh)}})();(function(){var b=bongiovi.GL;ViewStars=function(){bongiovi.View.call(this,"assets/shaders/star.vert","assets/shaders/star.frag")};var a=ViewStars.prototype=new bongiovi.View;a._init=function(){for(var a=[],g=[],d=[],f=[],e=0;e<SuModel.stars.length;e++){var h=SuModel.stars[e],k=Sutils.getStarPosition(h.ra,h.de,500);a.push(k);g.push([0,0]);d.push(e);f.push([h.mag,h.isInConstellation?1:0.45,h.isJoint?0.5:0])}this.mesh=new bongiovi.Mesh(a.length,d.length,b.gl.POINTS);this.mesh.bufferVertex(a);this.mesh.bufferTexCoords(g);
this.mesh.bufferIndices(d);this.mesh.bufferData(f,"aExtra",3)};a.render=function(a){this.shader.isReady()&&(this.shader.bind(),this.shader.uniform("texture","uniform1i",0),this.shader.uniform("cameraRadius","uniform1f",params.cameraRadius),a.bind(0),b.draw(this.mesh))}})();
