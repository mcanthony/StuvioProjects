(function(){var c=bongiovi.GL;SuApp=function(b){this._canvas=b;c.init(this._canvas,null,null,{preserveDrawingBuffer:!0});this._init()};var a=SuApp.prototype;a._init=function(){bongiovi.SimpleImageLoader.load("assets/images/bg.jpg assets/images/bgInvert.jpg assets/images/ConstellationCircleInvert.png assets/images/ConstellationCircle.png assets/images/milkyWayCopy.png assets/images/starLine.png".split(" "),this,this._init3D)};a._init3D=function(b){SuModel.images=b;SuModel.currentState={};this._scene=
new SceneSu;c.setSize(this._canvas.width,this._canvas.height);bongiovi.Scheduler.addEF(this,this._loop)};a.refresh=function(b){this._scene&&this._scene.refresh(b)};a._loop=function(){this._scene.loop()};a.resize=function(){c.setSize(this._canvas.width,this._canvas.height)}})();(function(){var c=bongiovi.GL,a=c.gl,b=bongiovi.GLTexture,k=bongiovi.ViewCopy;SceneSu=function(){bongiovi.Scene.call(this);window.params={constellationIndex:-1,cameraRadius:500,isInvert:!1};c.gl.lineWidth(1.5);this.sceneRotation.rotateMargin=100;this.sceneRotation.inverseControl(!0);this._invert=!1;this.cameraPositions=SuModel.cameraPositions;window.addEventListener("keydown",this._onSave.bind(this));c.canvas.addEventListener("touchstar",this._onMouseDown.bind(this));c.canvas.addEventListener("mousedown",
this._onMouseDown.bind(this));params.constellationIndex=0;this._onConstellationChange();for(var d=SuModel.stars,b=[],a=["constellation","constellationIndex","distance"],k=0;k<d.length;k++){var e=d[k],n={},p;for(p in e)-1==a.indexOf(p)&&(n[p]=e[p]);n.ra=f(e.ra);n.de=f(e.de);b.push(n)}};var e=SceneSu.prototype=new bongiovi.Scene;e._initGUI=function(){this._gui=new dat.GUI({width:300});var d=this;this._gui.add(params,"constellationIndex",0,88).listen().onChange(function(){d._onConstellationChange()})};
e.refresh=function(d){params.constellationIndex!=Math.floor(d.constellationIndex.value)&&(console.debug("Change constellation",params.constellationIndex,Math.floor(d.constellationIndex.value)),params.constellationIndex=Math.floor(d.constellationIndex.value),this._onConstellationChange());this._invert=d.invertColor.value;params.isInvert=this._invert};e._onConstellationChange=function(){var d=Sutils.getDrawingPath(params.constellationIndex),b=this.cameraPositions[params.constellationIndex];b&&(this.sceneRotation.setCameraPos(b.quat),
this.camera.radius.value=b.z);this._loadedCount=0;""!=d?(d="./assets/images/hevelius/"+d,console.log("Path : ",d),b=new Image,b.addEventListener("load",this._onImageLoaded.bind(this)),b.src=d,d=d.replace("hevelius","heveliusInvert"),b=new Image,b.addEventListener("load",this._onImageInvertLoaded.bind(this)),b.src=d,this._vCircleBg.targetAlpha=1,this._vDrawings.tweenAlpha(0,0)):(console.log("Image doesn't exist : ",Sutils.getConstellatinDetail(params.constellationIndex)),this._vDrawings.targetAlpha=
0,this._vCircleBg.targetAlpha=0);if(d=Sutils.getConstellatinDetail(params.constellationIndex))b=new Image,b.addEventListener("load",this._onDescImageLoaded.bind(this)),b.src=this._invert?"assets/images/copyInvert/"+d.abb+".png":"assets/images/copy/"+d.abb+".png",this._vDesc.tweenAlpha(0,0),this._vCopyMilkyway.targetAlpha=0,this._vCopyEliptic.targetAlpha=0};e._onImageLoaded=function(d){void 0==this._textDrawing?this._textDrawing=new b(d.target):this._textDrawing.updateTexture(d.target);this._loadedCount++;
2==this._loadedCount&&(this._vDrawings.tweenAlpha(0,1),this._vDesc.tweenAlpha(0,1))};e._onImageInvertLoaded=function(d){void 0==this._textDrawingInvert?this._textDrawingInvert=new b(d.target):this._textDrawingInvert.updateTexture(d.target);this._loadedCount++;2==this._loadedCount&&(this._vDrawings.tweenAlpha(0,1),this._vDesc.tweenAlpha(0,1))};e._onDescImageLoaded=function(d){void 0==this._textDesc?this._textDesc=new b(d.target):this._textDesc.updateTexture(d.target);this._loadedCount++;2==this._loadedCount&&
this._vDrawings.tweenAlpha(0,1)};e._initTextures=function(){a=c.gl;this._textBG=new b(SuModel.images.bg);this._textBGInvert=new b(SuModel.images.bgInvert);this._textStar=new b(SuModel.images.starLine);this._textCircleBg=new b(SuModel.images.ConstellationCircle);this._textMilkyCopy=new b(SuModel.images.milkyWayCopy)};e._initViews=function(){this._vCopy=new k;this._vStars=new ViewStars;this._vLines=new ViewLines;this._vStarmap=new ViewStarmap;this._vMilkyway=new ViewMilkyWays;this._vEcliptic=new ViewMilkyWays(!0);
this._vCircleBg=new ViewDrawings([0,0,0],1.03);this._vDrawings=new ViewDrawings([0,0,0],1.25);this._vDesc=new ViewDrawings([0,-0.68,0],1,0.25);this._vGlobeLines=new ViewGlobeLines;this._vBlack=new k(null,"assets/shaders/black.frag");this._vCopyMilkyway=new ViewMilkyWayCopy;this._vCopyEliptic=new ViewMilkyWayCopy(!0);this._effectComposer=new bongiovi.EffectComposer;this._passInvert=new bongiovi.Pass("assets/shaders/invert.frag",c.width,c.height);this._effectComposer.addPass(this._passInvert)};e.render=
function(){params.cameraRadius=this.camera.radius.value;this._saveState();this._invert?this.renderInvert():(a.disable(a.DEPTH_TEST),c.setMatrices(this.cameraOtho),c.rotate(this.rotationFront),this._vCopy.render(this._textBG),c.setMatrices(this.camera),c.rotate(this.sceneRotation.matrix),this._vGlobeLines.render(),this._vMilkyway.render(),this._vEcliptic.render(),this._vCopyMilkyway.render(this._textMilkyCopy),this._vCopyEliptic.render(this._textMilkyCopy),this._vStars.render(this._textStar),this._vLines.render(),
c.setMatrices(this.cameraOtho),c.rotate(this.rotationFront),this._textDesc&&this._vDesc.render(this._textDesc),this._textDrawing&&(this._vCircleBg.render(this._textCircleBg),c.enableAdditiveBlending(),this._vBlack.render(this._textCircleBg),c.enableAlphaBlending(),this._vDrawings.render(this._textDrawing)))};e.renderInvert=function(){a.lineWidth(1.5);a.disable(a.DEPTH_TEST);c.clear(0,0,0,0);c.enableAlphaBlending();c.setMatrices(this.cameraOtho);c.rotate(this.rotationFront);this._vCopy.render(this._textBGInvert);
c.setMatrices(this.camera);c.rotate(this.sceneRotation.matrix);this._vGlobeLines.render();this._vMilkyway.render();this._vEcliptic.render();this._vCopyMilkyway.render(this._textMilkyCopy);this._vCopyEliptic.render(this._textMilkyCopy);this._vStars.render(this._textStar);this._vLines.render();c.setMatrices(this.cameraOtho);c.rotate(this.rotationFront);this._textDesc&&this._vDesc.render(this._textDesc);this._textDrawingInvert&&(a.blendEquation(a.FUNC_REVERSE_SUBTRACT),this._vDrawings.render(this._textDrawing),
a.blendEquation(a.FUNC_ADD),c.enableAdditiveBlending(),this._vBlack.render(this._textCircleBg),c.enableAlphaBlending())};e._saveState=function(){SuModel.currentState.camera=this.sceneRotation.tempRotation;SuModel.currentState.cameraDepth=this.camera.radius.value;SuModel.currentState.constellationIndex=params.constellationIndex};e._onMouseDown=function(b){params.constellationIndex=-1;this._vDrawings&&(this._vDrawings.targetAlpha=0);this._vDesc&&(this._vDesc.targetAlpha=0);this._vCircleBg&&(this._vCircleBg.targetAlpha=
0);this._vCopyMilkyway.targetAlpha=1;this._vCopyEliptic.targetAlpha=1};e._onSave=function(b){if(83==b.keyCode){b=c.canvas.toDataURL("image/jpeg");var a=new Image;a.src=b;document.body.appendChild(a);a.style.position="absolute"}else if(84==b.keyCode)b=Sutils.getQuatRotation(SuModel.cameraPositions[75].quaternion),this.sceneRotation.setCameraPos(b);else if(39==b.keyCode)params.constellationIndex++,this._onConstellationChange();else if(37==b.keyCode)params.constellationIndex--,0>params.constellationIndex&&
(params.constellationIndex=0),this._onConstellationChange();else if(80==b.keyCode)this.cameraPositions[params.constellationIndex]={z:this.camera.position[2],quat:[f(this.sceneRotation.tempRotation[0]),f(this.sceneRotation.tempRotation[1]),f(this.sceneRotation.tempRotation[2]),f(this.sceneRotation.tempRotation[3])]},console.log("Saving : ",this.cameraPositions[params.constellationIndex]);else if(87==b.keyCode){b=JSON.stringify(this.cameraPositions);for(var a=[],k=0;k<b.length;k++)a[k]=b.charCodeAt(k);
b=new Uint8Array(a);b=new Blob([b],{type:"application/octet-stream"});url=URL.createObjectURL(b);b=document.createElement("a");b.setAttribute("href",url);b.setAttribute("download","cameraPosition.json");a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null);b.dispatchEvent(a)}};var f=function(b,c){var a=Math.pow(10,c||4);return Math.floor(b*a)/a}})();var Sutils={getStarPosition:function(c,a,b){var k=z=0,e=Math.PI/180,f=b*Math.sin(a*e);a=b*Math.cos(a*e);k=-a*Math.cos(c*e);z=a*Math.sin(c*e);return[k,f,z]},getStarById:function(c){for(var a=0;a<SuModel.stars.length;a++)if(SuModel.stars[a].id==c)return SuModel.stars[a]},getQuatRotation:function(c){c=c.split(",");return quat.fromValues(parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]))},getDrawingPath:function(c){for(var a in SuModel.drawings)if(parseInt(SuModel.drawings[a].split("imgConstellation")[1])==
c)return a.replace(".jpg",".png");return""},getConstellatinDetail:function(c){if(!SuModel.constellations[c])return null;c=SuModel.constellations[c].id;for(var a=0;a<SuModel.constellationDesc.length;a++)if(SuModel.constellationDesc[a].abb==c)return SuModel.constellationDesc[a];return null}};(function(){var c=bongiovi.GL;ViewDrawings=function(b,c,a){this.targetAlpha=this._alpha=1;this.easing=0.1;this._position=b||[];this._scale=void 0==c?1:c;this._ratio=void 0==a?1:a;bongiovi.View.call(this,bongiovi.ShaderLibs.getShader("generalVert"),bongiovi.ShaderLibs.getShader("alphaFrag"))};var a=ViewDrawings.prototype;a._init=function(){this.mesh=bongiovi.MeshUtils.createPlane(2,2,1)};a.tweenAlpha=function(b,c){this._alpha=b;this.targetAlpha=c};a.render=function(b){this.mesh&&(this._alpha+=(this.targetAlpha-
this._alpha)*this.easing,this.shader.bind(),this.shader.uniform("texture","uniform1i",0),this.shader.uniform("opacity","uniform1f",this._alpha),this.shader.uniform("position","uniform3fv",this._position),this.shader.uniform("scale","uniform3fv",[this._scale,c.aspectRatio*this._scale*this._ratio,this._scale]),b.bind(0),c.draw(this.mesh))}})();(function(){var c=bongiovi.GL;ViewGlobeLines=function(){bongiovi.View.call(this,"assets/shaders/globeLine.vert","assets/shaders/globeLine.frag")};var a=ViewGlobeLines.prototype=new bongiovi.View;a._init=function(){var b=[],a=[],e=[],f=0,d,g,h=function(b,a){var c=b/64*Math.PI-0.5*Math.PI,d=a/64*Math.PI*2,k=[];k[1]=510*Math.sin(c);c=510*Math.cos(c);k[0]=Math.cos(d)*c;k[2]=Math.sin(d)*c;return k};for(g=0;64>g;g+=4)for(d=0;64>d;d++){var l=h(d,g),m=h(d+1,g);b.push(l);b.push(m);a.push(l);a.push(m);e.push(f);
e.push(f+1);f+=2}for(g=0;64>g;g++)for(d=0;64>d;d+=4)l=h(d,g),m=h(d,g+1),b.push(l),b.push(m),a.push(l),a.push(m),e.push(f),e.push(f+1),f+=2;this.mesh=new bongiovi.Mesh(b.length,e.length,c.gl.LINES);this.mesh.bufferVertex(b);this.mesh.bufferTexCoords(a);this.mesh.bufferIndices(e)};a.render=function(){this.mesh&&(this.shader.bind(),this.shader.uniform("color","uniform3fv",[1,1,1]),this.shader.uniform("opacity","uniform1f",0.05),this.shader.uniform("cameraRadius","uniform1f",params.cameraRadius),this.shader.uniform("isInvert",
"uniform1f",params.isInvert),c.draw(this.mesh))}})();(function(){var c=bongiovi.GL;ViewLines=function(){bongiovi.View.call(this,"assets/shaders/lines.vert","assets/shaders/lines.frag")};var a=ViewLines.prototype=new bongiovi.View;a._init=function(){for(var b=[],a=[],e=[],f=0,d=0;d<SuModel.constellations.length;d++)for(var g=SuModel.constellations[d].lines,h=0;h<g.length;h++){var l=g[h],m=Sutils.getStarById(l[0]),l=Sutils.getStarById(l[1]),m=Sutils.getStarPosition(m.ra,m.de,500),l=Sutils.getStarPosition(l.ra,l.de,500);b.push(m);b.push(l);a.push([d,0]);
a.push([d,0]);e.push(f);e.push(f+1);f+=2}this.mesh=new bongiovi.Mesh(b.length,e.length,c.gl.LINES);this.mesh.bufferVertex(b);this.mesh.bufferTexCoords(a);this.mesh.bufferIndices(e)};a.render=function(){this.shader.isReady()&&(this.shader.bind(),this.shader.uniform("currentIndex","uniform1f",params.constellationIndex),this.shader.uniform("cameraRadius","uniform1f",params.cameraRadius),this.shader.uniform("invert","uniform1f",params.isInvert?1:0),c.draw(this.mesh))}})();(function(){var c=bongiovi.GL;ViewMilkyWayCopy=function(b){this._isEcliptic=b||!1;this.targetAlpha=this._alpha=1;this.easing=0.1;b=b?[-0.015888573601841927,0.2025793343782425,0.9791369438171387,0]:[-0.4161895215511322,0.3992542028427124,0.7155793905258179,0.3941173553466797];this._rotation=new bongiovi.SceneRotation;this._rotation.tempRotation.set(b);this._rotation._rotation.set(b);this._rotation.update();this._rotation.lock();this.matrix=mat4.create();bongiovi.View.call(this,"assets/shaders/milkyway.vert",
bongiovi.ShaderLibs.getShader("alphaFrag"))};var a=ViewMilkyWayCopy.prototype=new bongiovi.View;a._init=function(){var b=[],a=[],e=[0,1,2,0,2,3,4,5,6,4,6,7];b.push([-70,-14,-480]);b.push([70,-14,-480]);b.push([70,56,-480]);b.push([-70,56,-480]);b.push([70,-14,480]);b.push([-70,-14,480]);b.push([-70,56,480]);b.push([70,56,480]);this._isEcliptic?(a.push([0,0]),a.push([1,0]),a.push([1,0.5]),a.push([0,0.5]),a.push([0,0]),a.push([1,0]),a.push([1,0.5]),a.push([0,0.5])):(a.push([0,0.5]),a.push([1,0.5]),
a.push([1,1]),a.push([0,1]),a.push([0,0.5]),a.push([1,0.5]),a.push([1,1]),a.push([0,1]));this.mesh=new bongiovi.Mesh(b.length,e.length,c.gl.TRIANGLES);this.mesh.bufferVertex(b);this.mesh.bufferTexCoords(a);this.mesh.bufferIndices(e)};a.render=function(b){this._alpha+=(this.targetAlpha-this._alpha)*this.easing;this.shader.bind();this.shader.uniform("texture","uniform1i",0);this.shader.uniform("opacity","uniform1f",this._alpha);this.shader.uniform("rotation","uniformMatrix4fv",this._rotation.matrix);
b.bind(0);c.draw(this.mesh)}})();(function(){var c=bongiovi.GL;ViewMilkyWays=function(b){this._isEcliptic=b||!1;var a=b?[-0.015888573601841927,0.2025793343782425,0.9791369438171387,0]:[-0.4161895215511322,0.3992542028427124,0.7155793905258179,0.3941173553466797];this._lineColor=b?[0.1176,0.4745,0.8902,1]:[1,0.8745,0.6039,0.15];this._rotation=new bongiovi.SceneRotation;this._rotation.tempRotation.set(a);this._rotation._rotation.set(a);this._rotation.update();this._rotation.lock();bongiovi.View.call(this,"assets/shaders/milkyway.vert",
"assets/shaders/milkyway.frag")};var a=ViewMilkyWays.prototype=new bongiovi.View;a._init=function(){function b(a,b,c,d,e,f){a=a/b*Math.PI*2;d=vec3.clone([c*Math.cos(a),Math.sin(a*d+f)*e,c*Math.sin(a)]);vec3.normalize(d,d);vec3.scale(d,d,c);return d}gl=c.gl;var a=this._isEcliptic?1500:100,e=[],f=[],d=[],g=0;if(this._isEcliptic)for(var h=0;h<a;h++)e.push(b(h,a,500,1,0,0)),e.push(b(h+1,a,500,1,0,0)),f.push([0,h%5]),f.push([0,h%5]),d.push(g),d.push(g+1),g+=2;else for(var l=0,m=60,n=0;10>n;n++)for(var m=
m-5,p=l,l=l+0.05*n,h=0;h<a;h++)e.push(b(h,a,500,2,m,p)),e.push(b(h+1,a,500,2,m,p)),f.push([h/a,0]),f.push([(h+1)/a,0]),d.push(g),d.push(g+1),g+=2;this.mesh=new bongiovi.Mesh(e.length,d.length,c.gl.LINES);this.mesh.bufferVertex(e);this.mesh.bufferTexCoords(f);this.mesh.bufferIndices(d)};a.render=function(){this.shader.bind();this.shader.uniform("rotation","uniformMatrix4fv",this._rotation.matrix);this.shader.uniform("cameraRadius","uniform1f",params.cameraRadius);this.shader.uniform("lineColor","uniform4fv",
this._lineColor);this.shader.uniform("isInvert","uniform1f",params.isInvert);c.draw(this.mesh)}})();(function(){var c=bongiovi.GL;ViewStarmap=function(){bongiovi.View.call(this,null,"assets/shaders/starmap.frag")};var a=ViewStarmap.prototype=new bongiovi.View;a._init=function(){this.mesh=bongiovi.MeshUtils.createSphere(510,24)};a.render=function(a){this.shader.bind();this.shader.uniform("texture","uniform1i",0);a.bind(0);c.draw(this.mesh)}})();(function(){var c=bongiovi.GL;ViewStars=function(){bongiovi.View.call(this,"assets/shaders/star.vert","assets/shaders/star.frag")};var a=ViewStars.prototype=new bongiovi.View;a._init=function(){for(var a=[],k=[],e=[],f=[],d=0;d<SuModel.stars.length;d++){var g=SuModel.stars[d],h=Sutils.getStarPosition(g.ra,g.de,500);a.push(h);k.push([0,0]);e.push(d);f.push([g.mag,g.isInConstellation?1:0.45,g.isJoint?0.5:0])}this.mesh=new bongiovi.Mesh(a.length,e.length,c.gl.POINTS);this.mesh.bufferVertex(a);this.mesh.bufferTexCoords(k);
this.mesh.bufferIndices(e);this.mesh.bufferData(f,"aExtra",3)};a.render=function(a){this.shader.isReady()&&(this.shader.bind(),this.shader.uniform("texture","uniform1i",0),this.shader.uniform("cameraRadius","uniform1f",params.cameraRadius),this.shader.uniform("invert","uniform1f",params.isInvert?1:0),a.bind(0),c.draw(this.mesh))}})();
