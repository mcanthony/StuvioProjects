(function(){var c=bongiovi.GL;SuApp=function(a){this._canvas=a;c.init(this._canvas,null,null,{preserveDrawingBuffer:!0});this._init()};var b=SuApp.prototype;b._init=function(){bongiovi.SimpleImageLoader.load("assets/images/bg.jpg assets/images/bgInvert.jpg assets/images/ConstellationCircleInvert.png assets/images/ConstellationCircleInvertAdd.png assets/images/ConstellationCircle.png assets/images/milkyWayCopy.png assets/images/starLine.png".split(" "),this,this._init3D)};b._init3D=function(a){SuModel.images=
a;SuModel.currentState={};this._scene=new SceneSu;c.setSize(this._canvas.width,this._canvas.height);bongiovi.Scheduler.addEF(this,this._loop)};b.refresh=function(a){this._scene&&this._scene.refresh(a)};b.isDone=function(){return void 0==this._scene?!1:this._scene.isDone()};b._loop=function(){this._scene.loop()};b.resize=function(){c.setSize(this._canvas.width,this._canvas.height)}})();(function(){var c=bongiovi.GL,b=c.gl,a=bongiovi.GLTexture,l=bongiovi.ViewCopy;SceneSu=function(){bongiovi.Scene.call(this);window.params={constellationIndex:-1,cameraRadius:500,isInvert:!1};c.gl.lineWidth(1.5);b.disable(b.DEPTH_TEST);this.sceneRotation.rotateMargin=100;this.sceneRotation.inverseControl(!0);this._invert=!1;this.cameraPositions=SuModel.cameraPositions;window.addEventListener("keydown",this._onSave.bind(this));c.canvas.addEventListener("touchstar",this._onMouseDown.bind(this));c.canvas.addEventListener("mousedown",
this._onMouseDown.bind(this));params.constellationIndex=0;this._onConstellationChange();var d=SuModel.stars,a=[],l=["constellation","constellationIndex","distance"];this._hasDrawings=!0;for(var e=0;e<d.length;e++){var k=d[e],n={},p;for(p in k)-1==l.indexOf(p)&&(n[p]=k[p]);n.ra=f(k.ra);n.de=f(k.de);a.push(n)}};var e=SceneSu.prototype=new bongiovi.Scene;e._initGUI=function(){this._gui=new dat.GUI({width:300});var d=this;this._gui.add(params,"constellationIndex",0,88).listen().onChange(function(){d._onConstellationChange()})};
e.refresh=function(d){params.constellationIndex!=Math.floor(d.constellationIndex.value)&&(params.constellationIndex=Math.floor(d.constellationIndex.value),this._onConstellationChange());this._invert=d.invertColor.value;params.isInvert=this._invert};e._onConstellationChange=function(){var d=Sutils.getDrawingPath(params.constellationIndex),a=this.cameraPositions[params.constellationIndex];a&&(this.sceneRotation.setCameraPos(a.quat),this.camera.radius.value=a.z);this._loadedCount=0;""!=d?(d="./assets/images/hevelius/"+
d,a=new Image,a.addEventListener("load",this._onImageLoaded.bind(this)),a.src=d,this._vCircleBg.targetAlpha=1,this._vDrawings.tweenAlpha(0,0),this._hasDrawings=!0):(this._vDrawings.targetAlpha=0,this._vCircleBg.targetAlpha=0,this._loadedCount++,this._hasDrawings=!1);if(d=Sutils.getConstellatinDetail(params.constellationIndex))a=new Image,a.addEventListener("load",this._onDescImageLoaded.bind(this)),a.src="assets/images/copy/"+d.abb+".png",a=new Image,a.addEventListener("load",this._onDescInvertImageLoaded.bind(this)),
a.src="assets/images/copyInvert/"+d.abb+".png",this._vDesc.tweenAlpha(0,0),this._vCopyMilkyway.targetAlpha=0,this._vCopyEliptic.targetAlpha=0};e._onImageLoaded=function(d){void 0==this._textDrawing?this._textDrawing=new a(d.target):this._textDrawing.updateTexture(d.target);this._loadedCount++;3==this._loadedCount&&(this._vDesc.tweenAlpha(0,1),this._vDrawings.tweenAlpha(0,1))};e._onDescImageLoaded=function(d){void 0==this._textDesc?this._textDesc=new a(d.target):this._textDesc.updateTexture(d.target);
this._loadedCount++;3==this._loadedCount&&(this._vDesc.tweenAlpha(0,1),this._vDrawings.tweenAlpha(0,1))};e._onDescInvertImageLoaded=function(d){void 0==this._textDescInvert?this._textDescInvert=new a(d.target):this._textDescInvert.updateTexture(d.target);this._loadedCount++;3==this._loadedCount&&(this._vDesc.tweenAlpha(0,1),this._vDrawings.tweenAlpha(0,1))};e._initTextures=function(){b=c.gl;this._textBG=new a(SuModel.images.bg);this._textBGInvert=new a(SuModel.images.bgInvert);this._textStar=new a(SuModel.images.starLine);
this._textCircleBg=new a(SuModel.images.ConstellationCircle);this._textCircleBgInvert=new a(SuModel.images.ConstellationCircleInvert);this._textCircleBgInvertAdd=new a(SuModel.images.ConstellationCircleInvertAdd);this._textMilkyCopy=new a(SuModel.images.milkyWayCopy)};e._initViews=function(){this._vCopy=new l;this._vStars=new ViewStars;this._vLines=new ViewLines;this._vStarmap=new ViewStarmap;this._vMilkyway=new ViewMilkyWays;this._vEcliptic=new ViewMilkyWays(!0);this._vCircleBg=new ViewDrawings([0,
0,0],1.03);this._vDrawings=new ViewDrawings([0,0,0],1.25);this._vDesc=new ViewDrawings([0,-0.68,0],1,0.25);this._vGlobeLines=new ViewGlobeLines;this._vBlack=new l(null,"assets/shaders/black.frag");this._vCopyMilkyway=new ViewMilkyWayCopy;this._vCopyEliptic=new ViewMilkyWayCopy(!0);this._effectComposer=new bongiovi.EffectComposer;this._passInvert=new bongiovi.Pass("assets/shaders/invert.frag",c.width,c.height);this._effectComposer.addPass(this._passInvert)};e.isDone=function(){return-1==this.sceneRotation._slerp&&
3==this._loadedCount};e.render=function(){params.cameraRadius=this.camera.radius.value;this._saveState();this._invert?this.renderInvert():(c.setMatrices(this.cameraOtho),c.rotate(this.rotationFront),this._vCopy.render(this._textBG),c.setMatrices(this.camera),c.rotate(this.sceneRotation.matrix),this._vGlobeLines.render(),this._vMilkyway.render(),this._vEcliptic.render(),this._vCopyMilkyway.render(this._textMilkyCopy),this._vCopyEliptic.render(this._textMilkyCopy),this._vStars.render(this._textStar),
this._vLines.render(),c.setMatrices(this.cameraOtho),c.rotate(this.rotationFront),this._textDesc&&this._vDesc.render(this._textDesc),this._textDrawing&&this._hasDrawings&&(this._vCircleBg.render(this._textCircleBg),c.enableAdditiveBlending(),this._vBlack.render(this._textCircleBg),c.enableAlphaBlending(),this._vDrawings.render(this._textDrawing)))};e.renderInvert=function(){c.enableAlphaBlending();c.setMatrices(this.cameraOtho);c.rotate(this.rotationFront);this._vCopy.render(this._textBGInvert);c.setMatrices(this.camera);
c.rotate(this.sceneRotation.matrix);this._vGlobeLines.render();this._vMilkyway.render();this._vEcliptic.render();this._vCopyMilkyway.render(this._textMilkyCopy);this._vCopyEliptic.render(this._textMilkyCopy);this._vStars.render(this._textStar);this._vLines.render();c.setMatrices(this.cameraOtho);c.rotate(this.rotationFront);this._textDesc&&this._vDesc.render(this._textDescInvert);this._textDrawing&&this._hasDrawings&&(this._vCircleBg.render(this._textCircleBgInvertAdd),b.blendEquation(b.FUNC_REVERSE_SUBTRACT),
this._vCircleBg.render(this._textCircleBgInvert),this._vDrawings.render(this._textDrawing),b.blendEquation(b.FUNC_ADD),c.enableAdditiveBlending(),this._vBlack.render(this._textCircleBg),c.enableAlphaBlending())};e._saveState=function(){SuModel.currentState.camera=this.sceneRotation.tempRotation;SuModel.currentState.cameraDepth=this.camera.radius.value;SuModel.currentState.constellationIndex=params.constellationIndex};e._onMouseDown=function(a){params.constellationIndex=-1;this._vDrawings&&(this._vDrawings.targetAlpha=
0);this._vDesc&&(this._vDesc.targetAlpha=0);this._vCircleBg&&(this._vCircleBg.targetAlpha=0);this._vCopyMilkyway.targetAlpha=1;this._vCopyEliptic.targetAlpha=1};e._onSave=function(a){if(83==a.keyCode){a=c.canvas.toDataURL("image/jpeg");var b=new Image;b.src=a;document.body.appendChild(b);b.style.position="absolute"}else if(84==a.keyCode)a=Sutils.getQuatRotation(SuModel.cameraPositions[75].quaternion),this.sceneRotation.setCameraPos(a);else if(39==a.keyCode)params.constellationIndex++,this._onConstellationChange();
else if(37==a.keyCode)params.constellationIndex--,0>params.constellationIndex&&(params.constellationIndex=0),this._onConstellationChange();else if(80==a.keyCode)this.cameraPositions[params.constellationIndex]={z:this.camera.position[2],quat:[f(this.sceneRotation.tempRotation[0]),f(this.sceneRotation.tempRotation[1]),f(this.sceneRotation.tempRotation[2]),f(this.sceneRotation.tempRotation[3])]},console.log("Saving : ",this.cameraPositions[params.constellationIndex]);else if(87==a.keyCode){a=JSON.stringify(this.cameraPositions);
for(var b=[],l=0;l<a.length;l++)b[l]=a.charCodeAt(l);a=new Uint8Array(b);a=new Blob([a],{type:"application/octet-stream"});url=URL.createObjectURL(a);a=document.createElement("a");a.setAttribute("href",url);a.setAttribute("download","cameraPosition.json");b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null);a.dispatchEvent(b)}};var f=function(a,c){var b=Math.pow(10,c||4);return Math.floor(a*b)/b}})();var Sutils={getStarPosition:function(c,b,a){var l=z=0,e=Math.PI/180,f=a*Math.sin(b*e);b=a*Math.cos(b*e);l=-b*Math.cos(c*e);z=b*Math.sin(c*e);return[l,f,z]},getStarById:function(c){for(var b=0;b<SuModel.stars.length;b++)if(SuModel.stars[b].id==c)return SuModel.stars[b]},getQuatRotation:function(c){c=c.split(",");return quat.fromValues(parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]))},getDrawingPath:function(c){for(var b in SuModel.drawings)if(parseInt(SuModel.drawings[b].split("imgConstellation")[1])==
c)return b.replace(".jpg",".png");return""},getConstellatinDetail:function(c){if(!SuModel.constellations[c])return null;c=SuModel.constellations[c].id;for(var b=0;b<SuModel.constellationDesc.length;b++)if(SuModel.constellationDesc[b].abb==c)return SuModel.constellationDesc[b];return null}};(function(){var c=bongiovi.GL;ViewDrawings=function(a,c,b){this.targetAlpha=this._alpha=1;this.easing=0.1;this._position=a||[];this._scale=void 0==c?1:c;this._ratio=void 0==b?1:b;bongiovi.View.call(this,bongiovi.ShaderLibs.getShader("generalVert"),bongiovi.ShaderLibs.getShader("alphaFrag"))};var b=ViewDrawings.prototype;b._init=function(){this.mesh=bongiovi.MeshUtils.createPlane(2,2,1)};b.tweenAlpha=function(a,c){this._alpha=a;this.targetAlpha=c};b.render=function(a){this.mesh&&(this._alpha+=(this.targetAlpha-
this._alpha)*this.easing,this.shader.bind(),this.shader.uniform("texture","uniform1i",0),this.shader.uniform("opacity","uniform1f",this._alpha),this.shader.uniform("position","uniform3fv",this._position),this.shader.uniform("scale","uniform3fv",[this._scale,c.aspectRatio*this._scale*this._ratio,this._scale]),a.bind(0),c.draw(this.mesh))}})();(function(){var c=bongiovi.GL;ViewGlobeLines=function(){bongiovi.View.call(this,"assets/shaders/globeLine.vert","assets/shaders/globeLine.frag")};var b=ViewGlobeLines.prototype=new bongiovi.View;b._init=function(){var a=[],b=[],e=[],f=0,d,g,h=function(a,b){var c=a/64*Math.PI-0.5*Math.PI,d=b/64*Math.PI*2,l=[];l[1]=510*Math.sin(c);c=510*Math.cos(c);l[0]=Math.cos(d)*c;l[2]=Math.sin(d)*c;return l};for(g=0;64>g;g+=4)for(d=0;64>d;d++){var m=h(d,g),k=h(d+1,g);a.push(m);a.push(k);b.push(m);b.push(k);e.push(f);
e.push(f+1);f+=2}for(g=0;64>g;g++)for(d=0;64>d;d+=4)m=h(d,g),k=h(d,g+1),a.push(m),a.push(k),b.push(m),b.push(k),e.push(f),e.push(f+1),f+=2;this.mesh=new bongiovi.Mesh(a.length,e.length,c.gl.LINES);this.mesh.bufferVertex(a);this.mesh.bufferTexCoords(b);this.mesh.bufferIndices(e)};b.render=function(){this.mesh&&(this.shader.bind(),this.shader.uniform("color","uniform3fv",[1,1,1]),this.shader.uniform("opacity","uniform1f",0.05),this.shader.uniform("cameraRadius","uniform1f",params.cameraRadius),this.shader.uniform("isInvert",
"uniform1f",params.isInvert),c.draw(this.mesh))}})();(function(){var c=bongiovi.GL;ViewLines=function(){bongiovi.View.call(this,"assets/shaders/lines.vert","assets/shaders/lines.frag")};var b=ViewLines.prototype=new bongiovi.View;b._init=function(){for(var a=[],b=[],e=[],f=0,d=0;d<SuModel.constellations.length;d++)for(var g=SuModel.constellations[d].lines,h=0;h<g.length;h++){var m=g[h],k=Sutils.getStarById(m[0]),m=Sutils.getStarById(m[1]),k=Sutils.getStarPosition(k.ra,k.de,500),m=Sutils.getStarPosition(m.ra,m.de,500);a.push(k);a.push(m);b.push([d,0]);
b.push([d,0]);e.push(f);e.push(f+1);f+=2}this.mesh=new bongiovi.Mesh(a.length,e.length,c.gl.LINES);this.mesh.bufferVertex(a);this.mesh.bufferTexCoords(b);this.mesh.bufferIndices(e)};b.render=function(){this.shader.isReady()&&(this.shader.bind(),this.shader.uniform("currentIndex","uniform1f",params.constellationIndex),this.shader.uniform("cameraRadius","uniform1f",params.cameraRadius),this.shader.uniform("invert","uniform1f",params.isInvert?1:0),c.draw(this.mesh))}})();(function(){var c=bongiovi.GL;ViewMilkyWayCopy=function(a){this._isEcliptic=a||!1;this.targetAlpha=this._alpha=1;this.easing=0.1;a=a?[-0.015888573601841927,0.2025793343782425,0.9791369438171387,0]:[-0.4161895215511322,0.3992542028427124,0.7155793905258179,0.3941173553466797];this._rotation=new bongiovi.SceneRotation;this._rotation.tempRotation.set(a);this._rotation._rotation.set(a);this._rotation.update();this._rotation.lock();this.matrix=mat4.create();bongiovi.View.call(this,"assets/shaders/milkyway.vert",
bongiovi.ShaderLibs.getShader("alphaFrag"))};var b=ViewMilkyWayCopy.prototype=new bongiovi.View;b._init=function(){var a=[],b=[],e=[0,1,2,0,2,3,4,5,6,4,6,7];a.push([-70,-14,-480]);a.push([70,-14,-480]);a.push([70,56,-480]);a.push([-70,56,-480]);a.push([70,-14,480]);a.push([-70,-14,480]);a.push([-70,56,480]);a.push([70,56,480]);this._isEcliptic?(b.push([0,0]),b.push([1,0]),b.push([1,0.5]),b.push([0,0.5]),b.push([0,0]),b.push([1,0]),b.push([1,0.5]),b.push([0,0.5])):(b.push([0,0.5]),b.push([1,0.5]),
b.push([1,1]),b.push([0,1]),b.push([0,0.5]),b.push([1,0.5]),b.push([1,1]),b.push([0,1]));this.mesh=new bongiovi.Mesh(a.length,e.length,c.gl.TRIANGLES);this.mesh.bufferVertex(a);this.mesh.bufferTexCoords(b);this.mesh.bufferIndices(e)};b.render=function(a){this._alpha+=(this.targetAlpha-this._alpha)*this.easing;this.shader.bind();this.shader.uniform("texture","uniform1i",0);this.shader.uniform("opacity","uniform1f",this._alpha);this.shader.uniform("rotation","uniformMatrix4fv",this._rotation.matrix);
a.bind(0);c.draw(this.mesh)}})();(function(){var c=bongiovi.GL;ViewMilkyWays=function(a){this._isEcliptic=a||!1;var b=a?[-0.015888573601841927,0.2025793343782425,0.9791369438171387,0]:[-0.4161895215511322,0.3992542028427124,0.7155793905258179,0.3941173553466797];this._lineColor=a?[0.1176,0.4745,0.8902,1]:[1,0.8745,0.6039,0.15];this._rotation=new bongiovi.SceneRotation;this._rotation.tempRotation.set(b);this._rotation._rotation.set(b);this._rotation.update();this._rotation.lock();bongiovi.View.call(this,"assets/shaders/milkyway.vert",
"assets/shaders/milkyway.frag")};var b=ViewMilkyWays.prototype=new bongiovi.View;b._init=function(){function a(a,b,c,d,e,f){a=a/b*Math.PI*2;d=vec3.clone([c*Math.cos(a),Math.sin(a*d+f)*e,c*Math.sin(a)]);vec3.normalize(d,d);vec3.scale(d,d,c);return d}gl=c.gl;var b=this._isEcliptic?1500:100,e=[],f=[],d=[],g=0;if(this._isEcliptic)for(var h=0;h<b;h++)e.push(a(h,b,500,1,0,0)),e.push(a(h+1,b,500,1,0,0)),f.push([0,h%5]),f.push([0,h%5]),d.push(g),d.push(g+1),g+=2;else for(var m=0,k=60,n=0;10>n;n++)for(var k=
k-5,p=m,m=m+0.05*n,h=0;h<b;h++)e.push(a(h,b,500,2,k,p)),e.push(a(h+1,b,500,2,k,p)),f.push([h/b,0]),f.push([(h+1)/b,0]),d.push(g),d.push(g+1),g+=2;this.mesh=new bongiovi.Mesh(e.length,d.length,c.gl.LINES);this.mesh.bufferVertex(e);this.mesh.bufferTexCoords(f);this.mesh.bufferIndices(d)};b.render=function(){this.shader.bind();this.shader.uniform("rotation","uniformMatrix4fv",this._rotation.matrix);this.shader.uniform("cameraRadius","uniform1f",params.cameraRadius);this.shader.uniform("lineColor","uniform4fv",
this._lineColor);this.shader.uniform("isInvert","uniform1f",params.isInvert);c.draw(this.mesh)}})();(function(){var c=bongiovi.GL;ViewStarmap=function(){bongiovi.View.call(this,null,"assets/shaders/starmap.frag")};var b=ViewStarmap.prototype=new bongiovi.View;b._init=function(){this.mesh=bongiovi.MeshUtils.createSphere(510,24)};b.render=function(a){this.shader.bind();this.shader.uniform("texture","uniform1i",0);a.bind(0);c.draw(this.mesh)}})();(function(){var c=bongiovi.GL;ViewStars=function(){bongiovi.View.call(this,"assets/shaders/star.vert","assets/shaders/star.frag")};var b=ViewStars.prototype=new bongiovi.View;b._init=function(){for(var a=[],b=[],e=[],f=[],d=0;d<SuModel.stars.length;d++){var g=SuModel.stars[d],h=Sutils.getStarPosition(g.ra,g.de,500);a.push(h);b.push([0,0]);e.push(d);f.push([g.mag,g.isInConstellation?1:0.45,g.isJoint?0.5:0])}this.mesh=new bongiovi.Mesh(a.length,e.length,c.gl.POINTS);this.mesh.bufferVertex(a);this.mesh.bufferTexCoords(b);
this.mesh.bufferIndices(e);this.mesh.bufferData(f,"aExtra",3)};b.render=function(a){this.shader.isReady()&&(this.shader.bind(),this.shader.uniform("texture","uniform1i",0),this.shader.uniform("cameraRadius","uniform1f",params.cameraRadius),this.shader.uniform("invert","uniform1f",params.isInvert?1:0),a.bind(0),c.draw(this.mesh))}})();
